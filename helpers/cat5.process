# Archivist - network device config archiver
#
# this is a perl script for post-processing downloaded cisco CatOS config file 
# in short - load, filter as you wish, and save to the same filename
#

$conf_file=$ARGV[0];

open(DAT, $conf_file);
@conf_text=<DAT>;
close(DAT);
open(DAT, '>'.$conf_file);  # rewrite downloaded config file

$line=1;

foreach $confline (@conf_text)
 {

   # remove some unneeded lines from the config file
   # you can add something here to be filtered out from the archived CatOS config
   
   if(($confline=~/^\.+/) ||   	                  # dots displayed while building config
      ($confline=~/\(enable\)\s+$/) ||            # "enabled" prompt of CatOS device 
      ($confline=~/^#time/) ||                    # when config output was generated 
      ($confline=~/^TFTP session in progress/) || # some tftp upload message
      ($confline=~/^[1-2][0-9]{3}/) ||            # if it starts with a year - skip it (can be some log messages)
      ($confline=~/show config all/))             # show config command
    {next;} 

   else {print DAT $confline;}
   $line++;
 }

print DAT "\n";

close(DAT);

undef @conf_text;

# end
